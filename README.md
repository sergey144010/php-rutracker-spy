php-rutracker-spy
==========================

Version 0.0.1

Краткое описание
-------
Программа просматривает разделы форума rutracker.
В соответствии с установленным фильтром скачивает торрент файлы
и добавляет запись в базу данных.

Для чего?
-------
Далее настраиваете торрент клиент на скачивание новых торрентов из определенной папки
(в нашем случае из папки torrent) и получаете автоматическое скачивание новых торрентов с RuTracker.

Описание
-------
Программа логинится на rutracker. Сохраняет куки.
Открывает страницу. Парсит страницу получает темы.
Если темы проходят фильтр скачивает торрент файл и добавляет запись в базу данных.
При повторном заходе используются сохраненные куки.
Если темы проходят фильтр и они уже есть базе, то сверяется размер торрента.
И только торрент с большим размером файла будет заново скачан.
Только исходя из тех соображений, что на трекере больший размер файла = лучшее качество, хотя это и не
есть правда.

Зависимости
-------
Необходим установленный сервер баз данных - MySql.
(PHP, sunra/php-simple-html-dom-parser)

Установка
-------
Клонировать репозиторий.
```php
git clone https://github.com/sergey144010/php-rutracker-spy YOUR_PATH
```
Перейти в YOUR_PATH.
Установить зависимости командой
```php
composer update
```

Настройка
-------

Создать конфиг, запустив скрипт create_config.php
```php
php create_config.php
```

В созданном файле конфига config.php заполнить
настройки для подключения к базе данных
```php
    "db" =>
        [
            // Класс для работы с базой данных
            # Можно создать свой класс в соответствии с DbInterface
            # и подключить его здесь
            "class"=>"sergey144010\RutrackerSpy\Db",
            // Сервер базы данных
            "type"=>"mysql",
            // Хост базы данных
            "host"=>"localhost",
            // Имя базы данных
            "name"=>"rutracker_spy",
            // Имя пользователя и пароль для доступа к базе данных
            "user"=>"userName",
            "pass"=>"password",
        ],
```
Создать соответствующую базу данных в MySql. В нашем случае rutracker_spy.

Заполнить имя пользователя и пароль для входа на Rutracker.
```php
    "client" =>
        [
            "user"=>"login",
            "pass"=>"password",
        ],
```

Остальные настройки можно оставить как есть за исключением фильтра тем.

Для режима сервиса можно изменить промежуток времени запуска в секундах
```php
    "timer" =>
        [
            "time"=>"3600",
        ]
```

Настроить фильтр тем в файле sergey144010\RutrackerSpy\Filtr.php

```php
    $this->rule = ["комедия", "семейный", "приключения"];
```

или отключить фильтр в файле конфига config.php
```php
    "filtr" =>
        [
            // on - включен, off - выключен
            "turn"=>"off",
        ],
```
При отключенном фильтре все темы будут скачаны.

И собственно добавить отслеживаемые темы.
По умолчанию файл отслеживаемых тем  - themeSpy/theme.txt
Создать его и заполнить.
Формат следующий: новая строка = новый раздел
```php
http://rutracker.org/forum/viewforum.php?f=2200
http://rutracker.org/forum/viewforum.php?f=2093
```

Использование
-------

Однократный запуск
-------
```php
php run_once.php
```
или в Windows просто
```php
run_once.cmd
```

Многократный запуск
-------
```php
php run_service.php
```
или в Windows просто
```php
run_service.cmd
```

В режиме сервиса
-------
Для *nix
Добавить в сервисы run_service.php

Для Windows
Скачиваем программу http://nssm.cc/usage
Устанавливаем сервис
```php
nssm.exe install RuTrackerSpy "путь до run_service.cmd"
```
Например:
```php
nssm.exe install RuTrackerSpy "C:\RutrackerSpy\run_service.cmd"
```

Что нужно исправить/добавить
----------------------------
1. Отвязать парсер от фильтра. Переместить в класс фильтра. Добавить новый функционал.
2. Переписать класс работы с базой данных.
3. Отвязаться от nameRusHash.
4. Придумать что-то с web.